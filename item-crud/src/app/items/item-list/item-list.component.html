<div class="container mx-auto p-4">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">Itens</h1>
    <button (click)="openCreateModal()" class="bg-blue-600 text-white px-4 py-2 rounded">Novo Item</button>
  </div>

  <div *ngIf="items.length === 0" class="text-center text-gray-500">Nenhum item cadastrado.</div>

  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
    <div *ngFor="let item of items" class="bg-white shadow rounded overflow-hidden">
      <img [src]="item.imageUrl" [alt]="item.title" class="w-full h-48 object-contain" />
      <div class="p-4">
        <h2 class="text-lg font-semibold mb-2">{{ item.title }}</h2>
        <p class="text-gray-700 mb-4">{{ item.description }}</p>
        <div class="flex justify-end space-x-2">
          <button (click)="editItem(item)" class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded">Editar</button>
          <button (click)="deleteItem(item)" class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded">Excluir</button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="itemToDelete" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" (click)="cancelDelete()">
    <div class="bg-white rounded-lg shadow-lg max-w-sm w-full p-6" (click)="$event.stopPropagation()">
      <h2 class="text-xl font-semibold mb-4">Confirmar exclusão</h2>
      <p class="mb-6">Tem certeza que deseja remover "{{ itemToDelete?.title }}"?</p>
      <div class="flex justify-end space-x-2">
        <button (click)="cancelDelete()" class="px-4 py-2 border rounded">Cancelar</button>
        <button (click)="confirmDelete()" class="px-4 py-2 bg-red-600 text-white rounded">Excluir</button>
      </div>
    </div>
  </div>

  <div *ngIf="itemToEdit" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" (click)="cancelEdit()">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-[28rem] p-6" (click)="$event.stopPropagation()">
      <h2 class="text-xl font-semibold mb-4">Editar item</h2>
      <form [formGroup]="editForm" class="flex flex-col space-y-4">
        <input formControlName="title" placeholder="Título" class="border p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />
        <textarea formControlName="description" placeholder="Descrição" class="border p-2 rounded h-24 resize-none focus:outline-none focus:ring-2 focus:ring-blue-500"></textarea>

        <!-- Input para nova imagem -->
        <input type="file" accept="image/*" (change)="fileChangeEventEdit($event)" class="border p-2 rounded focus:outline-none focus:ring-2 focus:ring-blue-500" />

        <!-- Cropper somente se uma nova imagem for selecionada -->
        <image-cropper
          *ngIf="imageChangedEventEdit"
          class="w-full max-h-64"
          [imageChangedEvent]="imageChangedEventEdit"
          [maintainAspectRatio]="false"
          [resizeToWidth]="256"
          format="png"
          [output]="'base64'"
          (imageCropped)="imageCroppedEdit($event)"></image-cropper>

        <!-- Campo oculto para manter o valor da imagem -->
        <input formControlName="imageUrl" type="hidden" />

        <div class="flex justify-end space-x-2 pt-2">
          <button type="button" (click)="cancelEdit()" class="px-4 py-2 border rounded hover:bg-gray-100">Cancelar</button>
          <button type="button" (click)="applyEdit()" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded disabled:opacity-60" [disabled]="editForm.invalid">Aplicar</button>
        </div>
      </form>
    </div>
  </div>

  <div *ngIf="isCreateModalOpen" class="fixed h-full inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50" (click)="cancelCreate()">
    <div class="bg-white rounded-lg shadow-lg w-full max-w-[20%] p-6" (click)="$event.stopPropagation()">
      <h2 class="text-xl font-semibold mb-4">Novo Item</h2>
      <form [formGroup]="createForm" class="flex flex-col md:flex-row gap-6">
        <div class="flex-1 flex flex-col space-y-4">
          <input formControlName="title" placeholder="Título" class="border p-2 rounded" />
          <textarea formControlName="description" placeholder="Descrição" class="border p-2 rounded"></textarea>

          <input type="file" accept="image/*" (change)="fileChangeEvent($event)" class="border p-2 rounded" />

          <image-cropper
            *ngIf="imageChangedEvent"
            class="w-full max-h-64"
            [imageChangedEvent]="imageChangedEvent"
            [maintainAspectRatio]="false"
            [resizeToWidth]="256"
            format="png"
            [output]="'base64'"
            (imageCropped)="imageCropped($event)"></image-cropper>

          <div class="flex justify-end space-x-2">
            <button type="button" (click)="cancelCreate()" class="px-4 py-2 border rounded">Cancelar</button>
            <button type="button" (click)="createItem()" class="px-4 py-2 bg-blue-600 text-white rounded" [disabled]="createForm.invalid">Criar</button>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
